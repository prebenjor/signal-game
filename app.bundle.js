(()=>{(()=>{let r=t=>document.querySelector(t),te=t=>Array.from(document.querySelectorAll(t)),dt="signalDeskProfiles",ut="signalDeskActive",I=[{id:"scanner",name:"Scanner Drones",desc:"Autonomous drones harvesting weak signal.",baseCost:15,growth:1.18,perSec:.4,click:.05},{id:"relay",name:"Relay Towers",desc:"Signal amplification backbone for long-haul sweeps.",baseCost:85,growth:1.2,perSec:2.4,click:.15},{id:"well",name:"Quantum Wells",desc:"Stabilized wells that pull in dense signal.",baseCost:460,growth:1.22,perSec:10,click:.35},{id:"forge",name:"Pulse Forge",desc:"High-frequency pulses convert noise to signal.",baseCost:2200,growth:1.23,perSec:45,click:.8},{id:"neural",name:"Neural Arrays",desc:"Adaptive pattern mining for constant yield.",baseCost:1e4,growth:1.24,perSec:210,click:1.6},{id:"void",name:"Void Extractors",desc:"Deep field extractors siphon latent signal.",baseCost:65e3,growth:1.25,perSec:920,click:3.2}],ft=[{id:"compression",name:"Signal Compression",desc:"+8% signal output per level.",baseCost:25,growth:1.5,max:6},{id:"distill",name:"Insight Distillation",desc:"+10% insight conversion per level.",baseCost:20,growth:1.45,max:6},{id:"feedback",name:"Resonant Feedback",desc:"+4% resonance gain per level.",baseCost:35,growth:1.55,max:5},{id:"logistics",name:"Expedition Logistics",desc:"-8% expedition time per level.",baseCost:28,growth:1.5,max:5},{id:"catalyst",name:"Archive Catalyst",desc:"+6% relic discovery per level.",baseCost:26,growth:1.5,max:5},{id:"analytics",name:"Mission Analytics",desc:"+10% mission rewards per level.",baseCost:24,growth:1.45,max:6}],pt=[{id:"echo",name:"Echo Amplifiers",desc:"+5% signal output per level.",baseCost:4,growth:1.6,max:10},{id:"insight",name:"Residual Insight",desc:"+6% insight conversion per level.",baseCost:4,growth:1.6,max:10},{id:"shadow",name:"Shadow Ops",desc:"+2% mission rewards per level.",baseCost:3,growth:1.5,max:20},{id:"dampers",name:"Anomaly Dampers",desc:"-8% anomaly duration per level.",baseCost:6,growth:1.55,max:8},{id:"sponsor",name:"Sponsor Relations",desc:"-5% sponsor cooldown per level.",baseCost:8,growth:1.6,max:8}],ht=[{id:"atlas",name:"Atlas Memory",desc:"+7% signal output per level.",baseCost:2,growth:1.7,max:12},{id:"stasis",name:"Stasis Vaults",desc:"+25% offline cap per level.",baseCost:2,growth:1.65,max:10},{id:"covenant",name:"Faction Concord",desc:"+10% faction reputation per level.",baseCost:3,growth:1.7,max:10},{id:"uplink",name:"Star Uplink",desc:"+6% expedition rewards per level.",baseCost:2,growth:1.6,max:12}],D=[{id:"sweep",name:"Signal Sweep",desc:"Short range scan run.",cost:250,duration:45e3,rewardSignal:800,rewardInsight:6,success:.9},{id:"deep",name:"Deep Listen",desc:"Mid-range expedition for rare signal.",cost:1400,duration:12e4,rewardSignal:5200,rewardInsight:18,success:.8},{id:"rift",name:"Rift Traverse",desc:"High-risk venture into unstable bands.",cost:9e3,duration:3e5,rewardSignal:3e4,rewardInsight:55,success:.7}],mt=[{id:"earn",label:"Harvest {goal} signal",goal:t=>Math.floor(2500*Math.pow(1.55,t-1)),progress:t=>t.cycle.earned,rewardType:"signal",rewardScale:.3},{id:"spend",label:"Spend {goal} signal",goal:t=>Math.floor(2e3*Math.pow(1.55,t-1)),progress:t=>t.cycle.spent,rewardType:"signal",rewardScale:.25},{id:"clicks",label:"Manual calibrations: {goal}",goal:t=>140+t*40,progress:t=>t.cycle.clicks,rewardType:"signal",rewardScale:12},{id:"expeditions",label:"Run {goal} expeditions",goal:t=>Math.max(2,Math.ceil(t/2)+1),progress:t=>t.cycle.expeditions,rewardType:"insight",rewardScale:6},{id:"upgrades",label:"Purchase {goal} upgrades",goal:t=>4+t,progress:t=>t.cycle.upgrades,rewardType:"signal",rewardScale:500},{id:"insight",label:"Distill {goal} insight",goal:t=>90+t*30,progress:t=>t.cycle.insight,rewardType:"insight",rewardScale:.25}],ee=[{name:"Fractal Prism",type:"signal",bonus:.04},{name:"Echo Coil",type:"signal",bonus:.05},{name:"Drift Compass",type:"insight",bonus:.05},{name:"Chrono Lens",type:"click",bonus:.04},{name:"Stellar Loom",type:"signal",bonus:.06},{name:"Mnemonic Key",type:"insight",bonus:.04},{name:"Pulse Anchors",type:"click",bonus:.05}],ne=[{id:"signal",label:"Signal Surge",signal:1.1,click:1,insight:1,mission:1},{id:"insight",label:"Insight Focus",signal:1,click:1,insight:1.15,mission:1},{id:"click",label:"Manual Edge",signal:1,click:1.2,insight:1,mission:1},{id:"mission",label:"Mission Rally",signal:1,click:1,insight:1,mission:1.15}],gt=[{id:"helios",name:"Helios Union",desc:"Industrial harvesters focused on steady signal expansion.",bonus:{signal:.08,offline:.2}},{id:"umbra",name:"Umbra Collective",desc:"Shadow analysts that amplify mission outcomes and relics.",bonus:{mission:.12,relic:.05}},{id:"aether",name:"Aether Guild",desc:"Explorers who favor insight conversion and expeditions.",bonus:{insight:.1,expedition:.08}}],C=[{name:"Initiate",threshold:0,mult:1},{name:"Agent",threshold:75,mult:1.1},{name:"Operative",threshold:200,mult:1.2},{name:"Command",threshold:500,mult:1.35},{name:"Director",threshold:1e3,mult:1.5}],vt=[{id:"surge",title:"Director: Signal Surge",body:"A high-energy wave is inbound. Choose a directive.",options:[{id:"stabilize",label:"Stabilize Wave",summary:"Signal +25% for 2 minutes.",apply:t=>Q(t,"Stabilized Surge",12e4,1.25,1.05)},{id:"harvest",label:"Harvest Spike",summary:"Gain instant signal.",apply:t=>k(t,Math.floor(600+t.signal*.15))}]},{id:"rift",title:"Director: Rift Echo",body:"A volatile rift opens with weak stability.",options:[{id:"anchor",label:"Anchor Beacons",summary:"Signal +15% and click +10% for 3 minutes.",apply:t=>Q(t,"Anchored Beacons",18e4,1.15,1.1)},{id:"salvage",label:"Salvage Fragments",summary:"Gain insight and a relic chance.",apply:t=>{R(t,10),X(t,M(t,Date.now()))}}]},{id:"protocol",title:"Director: Containment Protocol",body:"Incoming drift threatens signal integrity.",options:[{id:"contain",label:"Contain Drift",summary:"Remove active anomaly and gain signal.",apply:t=>{t.anomaly={label:"",mult:1,endsAt:0},k(t,1200)}},{id:"observe",label:"Observe Pattern",summary:"Gain insight and mission bonus.",apply:t=>{R(t,12),Q(t,"Pattern Insight",15e4,1.05,1.05)}}]},{id:"sponsor",title:"Director: Sponsor Ping",body:"A sponsor requests priority routing.",options:[{id:"accept",label:"Accept Contract",summary:"Reduce sponsor cooldown and gain signal.",apply:t=>{t.ads.cooldownUntil=Math.max(Date.now(),t.ads.cooldownUntil-12e4),k(t,900)}},{id:"decline",label:"Decline",summary:"Gain a relic and reset anomaly timer.",apply:t=>{X(t,M(t,Date.now())),t.nextAnomalyAt=Date.now()+E(6e4,12e4)}}]}],yt=[{id:"spark",name:"First Spark",desc:"Hold 1,000 signal.",test:t=>t.signal>=1e3,reward:{type:"signal",amount:500}},{id:"flow",name:"Signal Flow",desc:"Reach 50 signal per sec.",test:(t,e)=>e.perSec>=50,reward:{type:"insight",amount:10}},{id:"insight",name:"Clarity",desc:"Earn 50 insight.",test:t=>t.stats.totalInsight>=50,reward:{type:"signal",amount:1200}},{id:"voyager",name:"Voyager",desc:"Complete 5 expeditions.",test:t=>t.stats.expeditions>=5,reward:{type:"insight",amount:15}},{id:"architect",name:"Architect",desc:"Purchase 20 upgrades.",test:t=>t.stats.totalUpgrades>=20,reward:{type:"signal",amount:2e3}},{id:"ascend",name:"First Ascension",desc:"Ascend once.",test:t=>t.stats.ascensions>=1,reward:{type:"resonance",amount:6}},{id:"archive",name:"Archivist",desc:"Discover 3 relics.",test:t=>t.archive.length>=3,reward:{type:"resonance",amount:4}},{id:"mission",name:"Field Marshal",desc:"Reach mission tier 3.",test:t=>t.missions.tier>=3,reward:{type:"insight",amount:20}},{id:"transcend",name:"Starlight",desc:"Transcend once.",test:t=>t.stats.transcends>=1,reward:{type:"starlight",amount:2}}],P=[{id:"signal_first",title:"First Broadcast",body:"The console hums to life. A faint signal breaks the noise and the relay lights up.",condition:t=>t.stats.totalEarned>=2e3},{id:"faction_choice",title:"Council Invitation",body:"Three factions request your alignment. Each offers a different path through the drift.",condition:t=>!!t.faction.id},{id:"ascend_echo",title:"Resonance Echo",body:"Your first ascent reverberates across the array. The system remembers you.",condition:t=>t.stats.lifetimeAscensions>=1},{id:"relic_found",title:"Relic Recovered",body:"A relic surfaces from the void, humming with archived intelligence.",condition:t=>t.archive.length>=1},{id:"directive_chain",title:"Director's Pattern",body:"The Director AI starts predicting your moves. Patterns emerge in the anomalies.",condition:t=>t.stats.anomalies>=3},{id:"starlight_seed",title:"Starlight Seed",body:"Beyond resonance lies starlight. A new lattice of power becomes available.",condition:t=>t.starlight>=1}],a={profiles:[],activeId:"",active:null,lastTickAt:Date.now(),lastSaveAt:0,saveTimer:null,adTimer:null,adTimeout:null,adEndsAt:0,lastMapSeed:null,cachedRates:null,lastHeavyRenderAt:0,needsFullRender:!0,dirty:{},rafHandle:null,nextRenderAt:0},s={},G=null;window.addEventListener("DOMContentLoaded",ie);function ie(){se(),ae(),oe(),j(),ce(),re()}function se(){s={tabs:{game:r("#tab-game"),profile:r("#tab-profile")},panels:{game:r("#panel-game"),profile:r("#panel-profile")},subtabs:te(".subtab"),gameClick:r("#gameClick"),convertInsight:r("#convertInsight"),ascendBtn:r("#ascendBtn"),statSignal:r("#statSignal"),statPerSec:r("#statPerSec"),statInsight:r("#statInsight"),statResonance:r("#statResonance"),statClick:r("#statClick"),statForecast:r("#statForecast"),dailyStatus:r("#dailyStatus"),anomalyStatus:r("#anomalyStatus"),buffStatus:r("#buffStatus"),adStatus:r("#adStatus"),offlineStatus:r("#offlineStatus"),upgradeList:r("#upgradeList"),researchList:r("#researchList"),expeditionStatus:r("#expeditionStatus"),expeditionList:r("#expeditionList"),signalMap:r("#signalMap"),mapRegen:r("#mapRegen"),missionStatus:r("#missionStatus"),missionList:r("#missionList"),aiStatus:r("#aiStatus"),aiEvent:r("#aiEvent"),factionStatus:r("#factionStatus"),factionList:r("#factionList"),adRelayStatus:r("#adRelayStatus"),adBoostBtn:r("#adBoostBtn"),metaStatus:r("#metaStatus"),metaList:r("#metaList"),transcendBtn:r("#transcendBtn"),legacyStatus:r("#legacyStatus"),legacyList:r("#legacyList"),archiveStatus:r("#archiveStatus"),archiveList:r("#archiveList"),storyStatus:r("#storyStatus"),storyList:r("#storyList"),achievementList:r("#achievementList"),logList:r("#logList"),accountName:r("#accountName"),accountCreate:r("#accountCreate"),accountRename:r("#accountRename"),accountDelete:r("#accountDelete"),accountSelect:r("#accountSelect"),accountSummary:r("#accountSummary"),prefDefaultTab:r("#prefDefaultTab"),prefCompact:r("#prefCompact"),prefAdsEnabled:r("#prefAdsEnabled"),resetGame:r("#resetGame"),adModal:r("#adModal"),adCountdown:r("#adCountdown"),adCancel:r("#adCancel"),toast:r("#toast")}}function ae(){s.tabs.game&&s.tabs.game.addEventListener("click",()=>T("game")),s.tabs.profile&&s.tabs.profile.addEventListener("click",()=>T("profile")),s.subtabs.forEach(t=>{t.addEventListener("click",()=>St(t.dataset.section))}),s.gameClick&&s.gameClick.addEventListener("click",wt),s.convertInsight&&s.convertInsight.addEventListener("click",Et),s.ascendBtn&&s.ascendBtn.addEventListener("click",Lt),s.mapRegen&&s.mapRegen.addEventListener("click",ue),s.adBoostBtn&&s.adBoostBtn.addEventListener("click",fe),s.adCancel&&s.adCancel.addEventListener("click",qt),s.upgradeList&&s.upgradeList.addEventListener("click",t=>{let e=t.target.closest("button[data-upgrade]");e&&$t(e.dataset.upgrade)}),s.researchList&&s.researchList.addEventListener("click",t=>{let e=t.target.closest("button[data-research]");e&&ve(e.dataset.research)}),s.metaList&&s.metaList.addEventListener("click",t=>{let e=t.target.closest("button[data-meta]");e&&ye(e.dataset.meta)}),s.legacyList&&s.legacyList.addEventListener("click",t=>{let e=t.target.closest("button[data-legacy]");e&&be(e.dataset.legacy)}),s.expeditionList&&s.expeditionList.addEventListener("click",t=>{let e=t.target.closest("button[data-expedition]");e&&xt(e.dataset.expedition)}),s.missionList&&s.missionList.addEventListener("click",t=>{let e=t.target.closest("button[data-mission]");e&&we(e.dataset.mission)}),s.factionList&&s.factionList.addEventListener("click",t=>{let e=t.target.closest("button[data-faction]");e&&Ee(e.dataset.faction)}),s.aiEvent&&s.aiEvent.addEventListener("click",t=>{let e=t.target.closest("button[data-ai-option]");e&&Ye(e.dataset.aiOption)}),s.transcendBtn&&s.transcendBtn.addEventListener("click",Me),s.accountCreate&&s.accountCreate.addEventListener("click",Mt),s.accountRename&&s.accountRename.addEventListener("click",pe),s.accountDelete&&s.accountDelete.addEventListener("click",he),s.accountSelect&&s.accountSelect.addEventListener("change",t=>{bt(t.target.value)}),s.accountName&&s.accountName.addEventListener("keydown",t=>{t.key==="Enter"&&Mt()}),s.prefDefaultTab&&s.prefDefaultTab.addEventListener("change",t=>{let e=t.target.value;a.active&&(a.active.prefs.defaultTab=e,T(e,!1),p())}),s.prefCompact&&s.prefCompact.addEventListener("change",t=>{a.active&&(a.active.prefs.compact=t.target.checked,document.body.classList.toggle("compact",t.target.checked),p())}),s.prefAdsEnabled&&s.prefAdsEnabled.addEventListener("change",t=>{a.active&&(a.active.prefs.adsEnabled=t.target.checked,p())}),s.resetGame&&s.resetGame.addEventListener("click",me),document.addEventListener("keydown",t=>{var n;let e=(n=t.target)==null?void 0:n.tagName;if(!(e==="INPUT"||e==="TEXTAREA"||e==="SELECT")){if(t.code==="Space"){t.preventDefault(),wt();return}(t.key==="c"||t.key==="C")&&Et(),(t.key==="a"||t.key==="A")&&Lt(),(t.key==="u"||t.key==="U")&&ge(),(t.key==="e"||t.key==="E")&&Ae(),t.altKey&&t.key==="1"&&T("game"),t.altKey&&t.key==="2"&&T("profile")}}),window.addEventListener("beforeunload",()=>{let t=v();t&&(t.lastActiveAt=Date.now(),H())})}function oe(){let t=null,e=localStorage.getItem(dt);if(e)try{t=JSON.parse(e)}catch{}t&&Array.isArray(t.profiles)?a.profiles=t.profiles:a.profiles=[Tt("Pilot")],a.profiles.forEach(Y);let n=localStorage.getItem(ut),i=a.profiles.find(o=>o.id===n);a.active=i||a.profiles[0],a.activeId=a.active.id}function H(){var t;try{(t=a.active)!=null&&t.game&&(a.active.game.lastActiveAt=Date.now()),localStorage.setItem(dt,JSON.stringify({version:2,profiles:a.profiles})),localStorage.setItem(ut,a.activeId),a.lastSaveAt=Date.now()}catch{}}function p(){a.saveTimer||(a.saveTimer=setTimeout(()=>{a.saveTimer=null,H()},1500))}function j(){a.active&&(Y(a.active),At(a.active.prefs),Ct(a.active.game),V(),x(),a.lastHeavyRenderAt=0,a.lastMapSeed=null,F(),q(!0))}function bt(t){let e=a.profiles.find(n=>n.id===t);e&&(a.active=e,a.activeId=e.id,Y(e),At(e.prefs),Ct(e.game),V(),x(),a.lastHeavyRenderAt=0,a.lastMapSeed=null,F(),q(!0),p())}function V(){if(!s.accountSelect)return;let t=a.profiles.map(e=>`<option value="${e.id}">${ot(e.name)}</option>`).join("");S(s.accountSelect,t),s.accountSelect.value=a.activeId}function At(t){t&&(s.prefDefaultTab&&(s.prefDefaultTab.value=t.defaultTab||"game"),s.prefCompact&&(s.prefCompact.checked=!!t.compact),s.prefAdsEnabled&&(s.prefAdsEnabled.checked=t.adsEnabled!==!1),document.body.classList.toggle("compact",!!t.compact),T(t.defaultTab||"game",!1),St(t.gameSection||"command",!1))}function T(t,e=!0){if(!s.panels.game||!s.panels.profile)return;let n=t==="game";s.panels.game.classList.toggle("hidden",!n),s.panels.profile.classList.toggle("hidden",n),s.tabs.game&&s.tabs.game.classList.toggle("active",n),s.tabs.profile&&s.tabs.profile.classList.toggle("active",!n),e&&a.active&&(a.active.prefs.defaultTab=t,p())}function St(t,e=!0){s.subtabs.forEach(n=>{n.classList.toggle("active",n.dataset.section===t)}),document.querySelectorAll(".gameGrid .card[data-section]").forEach(n=>{n.classList.toggle("hidden",n.getAttribute("data-section")!==t)}),e&&a.active&&(a.active.prefs.gameSection=t,p())}function ce(){a.lastTickAt=Date.now(),setInterval(le,250)}function re(){a.rafHandle&&cancelAnimationFrame(a.rafHandle);let t=()=>{let e=performance.now();e>=a.nextRenderAt&&(q(!1),a.nextRenderAt=e+120),a.rafHandle=requestAnimationFrame(t)};a.nextRenderAt=performance.now(),a.rafHandle=requestAnimationFrame(t)}function le(){let t=v();if(!t)return;let e=Date.now(),n=Math.min((e-a.lastTickAt)/1e3,3);a.lastTickAt=e,We(t),je(t,e),Ve(t,e),qe(t,e);let i=M(t,e);a.cachedRates=i,i.perSec>0&&n>0&&k(t,i.perSec*n),Se(t,e,i),e-a.lastSaveAt>1e4&&H()}function q(t){let e=v();if(!e)return;let n=Date.now(),i=a.cachedRates||M(e,n);a.cachedRates=i,ke(e,i,n),Be(e,n),Dt(e,i),Pe(e,n);let o=t||a.needsFullRender||n-a.lastHeavyRenderAt>=2e3,c=a.dirty;(o||c.upgrades)&&Le(e,i),(o||c.research)&&Te(e),(o||c.meta)&&De(e),(o||c.faction)&&Ce(e),(o||c.legacy)&&Ie(e,i),(o||c.expeditions)&&_e(e,i,n),(o||c.missions)&&Ne(e,i),(o||c.archive)&&Fe(e),(o||c.story)&&Re(e),(o||c.achievements)&&Oe(e),(o||c.log)&&Ue(e),Ge(e,i),He(e,i),o&&(a.needsFullRender=!1,a.lastHeavyRenderAt=n,de()),F()}function x(){a.needsFullRender=!0,a.dirty={upgrades:!0,research:!0,meta:!0,faction:!0,legacy:!0,expeditions:!0,missions:!0,archive:!0,story:!0,achievements:!0,log:!0}}function w(t){a.dirty||(a.dirty={}),t.forEach(e=>{a.dirty[e]=!0})}function de(){a.dirty={}}function wt(){let t=v();if(!t)return;let e=a.cachedRates||M(t,Date.now());k(t,e.clickPower),t.cycle.clicks+=1,t.stats.totalClicks+=1,p()}function Et(){let t=v();if(!t)return;let e=a.cachedRates||M(t,Date.now()),n=Math.floor(t.signal*.2);if(n<50){y("Need at least 50 signal to convert.");return}if(!tt(t,n))return;let i=Math.max(1,Math.floor(n/100*e.insightMult));R(t,i),h(t,`Converted ${d(n)} signal into ${d(i)} insight.`),w(["stats","log","research"]),p()}function ue(){let t=v();t&&(t.mapSeed=zt(),a.lastMapSeed=null,h(t,"Constellation map recalibrated."),w(["log"]),p(),F())}function fe(){let t=a.active;if(!t||!t.prefs.adsEnabled){y("Sponsor clips are disabled.");return}let e=v();if(!e)return;let n=Date.now(),i=et(e);if(n<e.ads.cooldownUntil){y(`Sponsor available in ${g(e.ads.cooldownUntil-n)}.`);return}en()}function Mt(){if(!s.accountName)return;let t=(s.accountName.value||"").trim();if(!t){y("Enter a name to create an account.");return}let e=Tt(t);a.profiles.push(e),s.accountName.value="",bt(e.id),p()}function pe(){if(!s.accountName||!a.active)return;let t=(s.accountName.value||"").trim();if(!t){y("Enter a new name.");return}a.active.name=t,s.accountName.value="",V(),Dt(a.active.game,a.cachedRates||M(a.active.game,Date.now())),w(["log"]),p()}function he(){if(!a.active)return;if(a.profiles.length<=1){y("Create another account before deleting this one.");return}window.confirm("Delete this account and its progress?")&&(a.profiles=a.profiles.filter(e=>e.id!==a.activeId),a.active=a.profiles[0],a.activeId=a.active.id,j(),p())}function me(){!a.active||!window.confirm("Reset game progress for this account?")||(a.active.game=_(),a.lastMapSeed=null,j(),x(),p())}function $t(t){let e=v();if(!e)return;let n=I.find(c=>c.id===t);if(!n)return;let i=m(e.upgrades,t),o=nt(n,i);if(!tt(e,o)){y("Not enough signal.");return}e.upgrades[t]=i+1,e.cycle.upgrades+=1,e.stats.totalUpgrades+=1,h(e,`Upgrade purchased: ${n.name}.`),w(["upgrades","log","missions","stats"]),p()}function ge(){let t=v();if(!t)return;let e=null;I.forEach(n=>{let i=m(t.upgrades,n.id),o=nt(n,i);(!e||o<e.cost)&&(e={def:n,cost:o})}),e&&$t(e.def.id)}function ve(t){let e=v();if(!e)return;let n=ft.find(c=>c.id===t);if(!n)return;let i=m(e.research,t);if(i>=n.max){y("Research already maxed.");return}let o=Gt(n,i);if(e.insight<o){y("Not enough insight.");return}e.insight-=o,e.research[t]=i+1,h(e,`Research upgraded: ${n.name}.`),w(["research","log","stats"]),p()}function ye(t){let e=v();if(!e)return;let n=ht.find(c=>c.id===t);if(!n)return;let i=m(e.meta,t);if(i>=n.max){y("Meta upgrade already maxed.");return}let o=jt(n,i);if(e.starlight<o){y("Not enough starlight.");return}e.starlight-=o,e.meta[t]=i+1,h(e,`Meta upgraded: ${n.name}.`),w(["meta","log"]),p()}function be(t){let e=v();if(!e)return;let n=pt.find(c=>c.id===t);if(!n)return;let i=m(e.legacy,t);if(i>=n.max){y("Legacy already maxed.");return}let o=Ht(n,i);if(e.resonance<o){y("Not enough resonance.");return}e.resonance-=o,e.legacy[t]=i+1,h(e,`Legacy upgraded: ${n.name}.`),w(["legacy","log"]),p()}function xt(t){let e=v();if(!e)return;if(e.expedition){y("Expedition already running.");return}let n=D.find($=>$.id===t);if(!n)return;if(!tt(e,n.cost)){y("Not enough signal.");return}let i=a.cachedRates||M(e,Date.now()),o=Math.floor(n.duration*i.expeditionSpeed),c=B(e),l=1+m(e.meta,"uplink")*.06,f=Math.floor(n.rewardSignal*l*(1+m(e.legacy,"echo")*.02)),A=Math.floor(n.rewardInsight*l*(1+Z(e).insight)),b=Wt(n.success+c.expedition,.6,.95);e.expedition={id:n.id,startedAt:Date.now(),endsAt:Date.now()+o,rewardSignal:f,rewardInsight:A,success:b},h(e,`${n.name} launched. ETA ${g(o)}.`),w(["expeditions","log"]),p()}function Ae(){var t,e;(e=(t=a.active)==null?void 0:t.game)!=null&&e.expedition||xt(D[0].id)}function Se(t,e,n){if(!t.expedition||e<t.expedition.endsAt)return;let i=t.expedition,o=D.find(l=>l.id===i.id);if(t.expedition=null,t.cycle.expeditions+=1,t.stats.expeditions+=1,Math.random()<=i.success)k(t,i.rewardSignal),R(t,i.rewardInsight),h(t,`${o.name} succeeded. +${d(i.rewardSignal)} signal.`),X(t,n),st(t,8);else{let l=Math.floor(i.rewardSignal*.25);k(t,l),h(t,`${o.name} failed. Salvaged ${d(l)} signal.`),st(t,3)}w(["expeditions","log","archive","faction","missions","stats"]),p()}function kt(t){t.missions||(t.missions={tier:1,list:[]}),Array.isArray(t.missions.list)||(t.missions.list=[]),t.missions.list.length===0&&(t.missions.list=Rt(t.missions.tier),p())}function we(t){let e=v();if(!e)return;kt(e);let n=e.missions.list.find(f=>f.id===t);if(!n)return;let i=It(n.templateId);if(i.progress(e)<n.goal){y("Mission not complete yet.");return}if(n.claimed)return;let c=a.cachedRates||M(e,Date.now()),l=Math.floor(n.reward*c.missionMult);_t(e,{type:n.rewardType,amount:l}),st(e,Math.floor(4+e.missions.tier*2)),n.claimed=!0,h(e,`Mission complete: ${i.label.replace("{goal}",d(n.goal))}.`),e.missions.list.every(f=>f.claimed)&&(e.missions.tier+=1,e.missions.list=Rt(e.missions.tier),h(e,`Mission tier ${e.missions.tier} unlocked.`)),w(["missions","log","stats","faction"]),p()}function Ee(t){let e=v();if(!e)return;let n=it(t);if(!n)return;let i=Date.now(),o=Vt(e);if(e.faction.id&&o>0){y(`Faction switch available in ${g(o)}.`);return}e.faction.id!==t&&(e.faction.id=t,e.faction.rep=0,e.faction.selectedAt=i,h(e,`Aligned with ${n.name}.`),x(),p())}function Lt(){let t=v();if(!t)return;let e=a.cachedRates||M(t,Date.now()),n=Ut(t,e);if(n<=0){y("Not enough signal to ascend.");return}window.confirm(`Ascend for +${d(n)} resonance? This resets signal, insight, upgrades, research, missions, expeditions, and anomalies.`)&&(t.resonance+=n,t.signal=0,t.insight=0,t.upgrades={},t.research={},t.cycle=W(),t.missions={tier:1,list:[]},t.aiEvent=null,t.aiCooldownAt=Date.now()+E(6e4,12e4),t.buff=null,t.ads={cooldownUntil:0,boostEndsAt:0},t.anomaly={label:"",mult:1,endsAt:0},t.nextAnomalyAt=Date.now()+E(6e4,12e4),t.expedition=null,t.stats.ascensions+=1,t.stats.lifetimeAscensions+=1,h(t,`Ascended. +${d(n)} resonance gained.`),x(),p())}function Me(){let t=v();if(!t)return;let e=Pt(t);if(e<=0){y("Not enough resonance to transcend.");return}window.confirm(`Transcend for +${d(e)} starlight? This resets resonance, legacy, upgrades, research, missions, expeditions, anomalies, relics, and ascension count.`)&&(t.starlight+=e,t.signal=0,t.insight=0,t.resonance=0,t.upgrades={},t.research={},t.legacy={},t.missions={tier:1,list:[]},t.cycle=W(),t.aiEvent=null,t.aiCooldownAt=Date.now()+E(6e4,12e4),t.buff=null,t.ads={cooldownUntil:0,boostEndsAt:0},t.anomaly={label:"",mult:1,endsAt:0},t.nextAnomalyAt=Date.now()+E(6e4,12e4),t.expedition=null,t.archive=[],t.faction.rep=0,t.offline={lastGain:0,lastSeconds:0,lastAt:Date.now()},t.lastActiveAt=Date.now(),t.stats.ascensions=0,t.stats.transcends+=1,h(t,`Transcended. +${d(e)} starlight gained.`),x(),p())}function Tt(t){return{id:`profile_${Date.now()}_${Math.floor(Math.random()*1e3)}`,name:t||"Pilot",prefs:K(),game:_()}}function K(){return{defaultTab:"game",compact:!1,adsEnabled:!0,gameSection:"command"}}function Y(t){t.prefs=t.prefs||K(),z(t.prefs,K()),t.game=$e(t.game)}function _(){let t=Date.now();return{version:2,signal:0,insight:0,resonance:0,starlight:0,upgrades:{},research:{},legacy:{},meta:{},faction:{id:"",rep:0,selectedAt:0},cycle:W(),missions:{tier:1,list:[]},aiEvent:null,aiCooldownAt:t+E(6e4,12e4),buff:null,ads:{cooldownUntil:0,boostEndsAt:0},daily:{date:"",id:"",label:"",signal:1,click:1,insight:1,mission:1},anomaly:{label:"",mult:1,endsAt:0},nextAnomalyAt:t+E(6e4,12e4),expedition:null,mapSeed:zt(),archive:[],story:{unlocked:[]},offline:{lastGain:0,lastSeconds:0,lastAt:0},lastActiveAt:t,achievements:{},log:[],stats:{totalEarned:0,totalSpent:0,totalInsight:0,totalClicks:0,expeditions:0,anomalies:0,ascensions:0,lifetimeAscensions:0,transcends:0,totalOffline:0,totalUpgrades:0}}}function $e(t){if(!t||typeof t!="object")return _();let e=_();return z(t,e),(!t.faction||typeof t.faction!="object")&&(t.faction={id:"",rep:0,selectedAt:0}),typeof t.faction.rep!="number"&&(t.faction.rep=0),typeof t.faction.selectedAt!="number"&&(t.faction.selectedAt=0),Array.isArray(t.story.unlocked)||(t.story.unlocked=[]),t}function W(){return{earned:0,spent:0,insight:0,clicks:0,expeditions:0,upgrades:0}}function z(t,e){Object.keys(e).forEach(n=>{let i=e[n];if(t[n]===void 0||t[n]===null){t[n]=xe(i);return}J(i)&&(J(t[n])||(t[n]={}),z(t[n],i))})}function xe(t){return Array.isArray(t)?t.slice():J(t)?{...t}:t}function J(t){return t&&typeof t=="object"&&!Array.isArray(t)}function ke(t,e,n){u(s.statSignal,d(t.signal)),u(s.statPerSec,d(e.perSec)),u(s.statInsight,d(t.insight)),u(s.statResonance,d(t.resonance)),u(s.statClick,d(e.clickPower)),u(s.statForecast,d(t.signal+e.perSec*60)),u(s.dailyStatus,t.daily.label?`Daily: ${t.daily.label}`:"Daily directive pending."),t.anomaly.endsAt&&n<t.anomaly.endsAt?u(s.anomalyStatus,`${t.anomaly.label} (${g(t.anomaly.endsAt-n)})`):u(s.anomalyStatus,`Next anomaly in ${g(Math.max(0,t.nextAnomalyAt-n))}.`),t.buff&&n<t.buff.endsAt?u(s.buffStatus,`${t.buff.label} (${g(t.buff.endsAt-n)})`):u(s.buffStatus,"No active AI buffs."),t.ads.boostEndsAt&&n<t.ads.boostEndsAt?u(s.adStatus,`Sponsor boost active (${g(t.ads.boostEndsAt-n)}).`):t.ads.cooldownUntil&&n<t.ads.cooldownUntil?u(s.adStatus,`Sponsor cooldown ${g(t.ads.cooldownUntil-n)}.`):u(s.adStatus,"Sponsor relay ready.");let i=Nt(t),o=Bt(t);t.offline.lastGain>0&&t.offline.lastSeconds>0?u(s.offlineStatus,`Offline recovery: +${d(t.offline.lastGain)} signal in ${g(t.offline.lastSeconds*1e3)}.`):u(s.offlineStatus,`Offline cap ${g(i*1e3)} at ${Math.round(o*100)}% rate.`)}function Le(t){let e=I.map(n=>{let i=m(t.upgrades,n.id),o=nt(n,i),c=t.signal<o;return`
        <div class="upgradeRow">
          <div class="rowDetails">
            <div class="rowTitle">${n.name} <span class="tag">Lv ${i}</span></div>
            <div class="rowMeta">${n.desc} (+${d(n.perSec)} /s)</div>
          </div>
          <button class="btn" data-upgrade="${n.id}" ${c?"disabled":""}>Buy ${d(o)}</button>
        </div>
      `}).join("");S(s.upgradeList,e)}function Te(t){let e=ft.map(n=>{let i=m(t.research,n.id),o=Gt(n,i),c=i>=n.max||t.insight<o;return`
        <div class="researchRow">
          <div class="rowDetails">
            <div class="rowTitle">${n.name} <span class="tag">Lv ${i}/${n.max}</span></div>
            <div class="rowMeta">${n.desc}</div>
          </div>
          <button class="btn" data-research="${n.id}" ${c?"disabled":""}>Spend ${d(o)}</button>
        </div>
      `}).join("");S(s.researchList,e)}function De(t){if(!s.metaList||!s.metaStatus)return;let e=Ot(t),n=Pt(t);u(s.metaStatus,`Starlight ${d(t.starlight)} | Transcend at ${d(e)} resonance for +${d(n)}.`),s.transcendBtn&&(s.transcendBtn.disabled=n<=0);let i=ht.map(o=>{let c=m(t.meta,o.id),l=jt(o,c),f=c>=o.max||t.starlight<l;return`
        <div class="metaRow">
          <div class="rowDetails">
            <div class="rowTitle">${o.name} <span class="tag">Lv ${c}/${o.max}</span></div>
            <div class="rowMeta">${o.desc}</div>
          </div>
          <button class="btn" data-meta="${o.id}" ${f?"disabled":""}>Invest ${d(l)}</button>
        </div>
      `}).join("");S(s.metaList,i)}function Ce(t){if(!s.factionList||!s.factionStatus)return;let e=it(t.faction.id),n=N(t.faction.rep),i=Ze(t.faction.rep),o=Vt(t);if(e){let l=i?` | Next ${i.name} at ${i.threshold} rep`:"";u(s.factionStatus,`Aligned with ${e.name} (${n.name}) | Rep ${t.faction.rep}${l}`)}else u(s.factionStatus,"No faction selected.");let c=gt.map(l=>{let f=l.id===t.faction.id,A=!f&&o<=0,b=tn(l,f?n.mult:1),$=f?` <span class="tag">${n.name}</span>`:"",L=f?"Active":A?"Enlist":`Cooldown ${g(o)}`;return`
        <div class="factionRow ${f?"active":""}">
          <div class="rowDetails">
            <div class="rowTitle">${l.name}${$}</div>
            <div class="rowMeta">${l.desc} ${b}</div>
          </div>
          <button class="btn" data-faction="${l.id}" ${f||!A?"disabled":""}>${L}</button>
        </div>
      `}).join("");S(s.factionList,c)}function Re(t){if(!s.storyList||!s.storyStatus)return;let e=Array.isArray(t.story.unlocked)?t.story.unlocked:[];u(s.storyStatus,`Unlocked ${e.length} / ${P.length} transmissions.`);let n=P.filter(i=>e.includes(i.id)).map(i=>`
        <div class="storyRow">
          <div class="rowDetails">
            <div class="rowTitle">${i.title}</div>
            <div class="rowMeta">${ot(i.body)}</div>
          </div>
        </div>
      `).join("");S(s.storyList,n||'<div class="status">No transmissions recovered yet.</div>')}function Ie(t,e){let n=Ft(t),i=Ut(t,e);u(s.legacyStatus,`Resonance ${d(t.resonance)} | Ascend at ${d(n)} for +${d(i)}.`);let o=pt.map(c=>{let l=m(t.legacy,c.id),f=Ht(c,l),A=l>=c.max||t.resonance<f;return`
        <div class="legacyRow">
          <div class="rowDetails">
            <div class="rowTitle">${c.name} <span class="tag">Lv ${l}/${c.max}</span></div>
            <div class="rowMeta">${c.desc}</div>
          </div>
          <button class="btn" data-legacy="${c.id}" ${A?"disabled":""}>Invest ${d(f)}</button>
        </div>
      `}).join("");S(s.legacyList,o)}function _e(t,e,n){if(t.expedition){let o=D.find(l=>l.id===t.expedition.id),c=Math.max(0,t.expedition.endsAt-n);u(s.expeditionStatus,`Active: ${o.name} (${g(c)}).`)}else u(s.expeditionStatus,"No active expedition.");let i=D.map(o=>{let c=!!t.expedition||t.signal<o.cost,l=Math.floor(o.duration*e.expeditionSpeed);return`
        <div class="expeditionRow">
          <div class="rowDetails">
            <div class="rowTitle">${o.name}</div>
            <div class="rowMeta">${o.desc} | ETA ${g(l)}</div>
          </div>
          <button class="btn" data-expedition="${o.id}" ${c?"disabled":""}>Launch ${d(o.cost)}</button>
        </div>
      `}).join("");S(s.expeditionList,i)}function Ne(t,e){kt(t),u(s.missionStatus,`Tier ${t.missions.tier} | Rewards x${e.missionMult.toFixed(2)}.`);let n=t.missions.list.map(i=>{let o=It(i.templateId),c=o.progress(t),l=c>=i.goal,f=Math.floor(i.reward*e.missionMult),A=o.label.replace("{goal}",d(i.goal)),b=i.claimed?"Claimed":l?"Claim":"In progress",$=l&&!i.claimed?"btn primary":"btn",L=i.claimed||!l;return`
          <div class="missionRow ${i.claimed?"done":""}">
            <div class="rowDetails">
              <div class="rowTitle">${A}</div>
              <div class="rowMeta">Progress ${d(c)} / ${d(i.goal)} | Reward ${d(f)} ${i.rewardType}</div>
            </div>
            <button class="${$}" data-mission="${i.id}" ${L?"disabled":""}>${b}</button>
          </div>
        `}).join("");S(s.missionList,n)}function Be(t,e){if(t.aiEvent){let n=Math.max(0,t.aiEvent.expiresAt-e);u(s.aiStatus,`Directive active (${g(n)}).`);let i=t.aiEvent.options.map(c=>`
          <div class="aiOption">
            <div class="rowDetails">
              <div class="rowTitle">${c.label}</div>
              <div class="rowMeta">${c.summary}</div>
            </div>
            <button class="btn" data-ai-option="${c.id}">Execute</button>
          </div>
        `).join(""),o=`
        <div class="aiEventCard">
          <div class="aiEventTitle">${t.aiEvent.title}</div>
          <div class="aiEventBody">${t.aiEvent.body}</div>
        </div>
        <div class="list">${i}</div>
      `;S(s.aiEvent,o)}else{let n=Math.max(0,t.aiCooldownAt-e);u(s.aiStatus,`Next directive in ${g(n)}.`),S(s.aiEvent,'<div class="status">No active directives.</div>')}}function Fe(t){let e=Z(t),n=(e.signal*100).toFixed(1),i=(e.click*100).toFixed(1),o=(e.insight*100).toFixed(1);u(s.archiveStatus,`Relics ${t.archive.length} | Signal +${n}% | Click +${i}% | Insight +${o}%`);let c=t.archive.map(l=>`
        <div class="archiveRow">
          <div class="rowDetails">
            <div class="rowTitle">${l.name}</div>
            <div class="rowMeta">${l.type} +${(l.bonus*100).toFixed(1)}%</div>
          </div>
        </div>
      `).join("");S(s.archiveList,c||'<div class="status">No relics discovered.</div>')}function Oe(t){let e=yt.map(n=>{let i=!!t.achievements[n.id];return`
        <div class="achievementRow ${i?"unlocked":""}">
          <div class="rowDetails">
            <div class="rowTitle">${n.name}</div>
            <div class="rowMeta">${n.desc}</div>
          </div>
          <span class="tag">${i?"Unlocked":"Locked"}</span>
        </div>
      `}).join("");S(s.achievementList,e)}function Ue(t){let n=t.log.slice(-12).reverse().map(i=>`
        <div class="logRow">
          <div class="rowDetails">
            <div class="rowTitle">${ot(i.text)}</div>
            <div class="rowMeta">${new Date(i.time).toLocaleTimeString()}</div>
          </div>
        </div>
      `).join("");S(s.logList,n||'<div class="status">No activity yet.</div>')}function Dt(t,e){if(!a.active||!s.accountSummary)return;let n=`Active ${a.active.name} | Ascensions ${t.stats.lifetimeAscensions} | Transcends ${t.stats.transcends} | Total signal ${d(t.stats.totalEarned)} | Per sec ${d(e.perSec)}`;u(s.accountSummary,n)}function Pe(t,e){var o;if(!s.adRelayStatus||!s.adBoostBtn)return;let n=((o=a.active)==null?void 0:o.prefs.adsEnabled)!==!1,i=et(t);if(!n){u(s.adRelayStatus,"Sponsor clips disabled in preferences."),s.adBoostBtn.disabled=!0;return}if(t.ads.boostEndsAt&&e<t.ads.boostEndsAt){u(s.adRelayStatus,`Boost active (${g(t.ads.boostEndsAt-e)}).`),s.adBoostBtn.disabled=!0;return}if(t.ads.cooldownUntil&&e<t.ads.cooldownUntil){u(s.adRelayStatus,`Cooldown ${g(t.ads.cooldownUntil-e)}.`),s.adBoostBtn.disabled=!0;return}u(s.adRelayStatus,`Boost ready. Cooldown ${g(i)}.`),s.adBoostBtn.disabled=!1}function Ge(t,e){t.story||(t.story={unlocked:[]}),Array.isArray(t.story.unlocked)||(t.story.unlocked=[]),P.forEach(n=>{t.story.unlocked.includes(n.id)||n.condition(t,e)&&(t.story.unlocked.push(n.id),h(t,`Transmission recovered: ${n.title}.`),w(["story","log"]))})}function Ct(t){if(!t)return;let e=Date.now(),n=t.lastActiveAt||e,i=Math.max(0,(e-n)/1e3),o=Nt(t),c=Math.min(i,o);if(c<30){t.offline.lastGain=0,t.offline.lastSeconds=0,t.lastActiveAt=e;return}let l=M(t,e),f=Bt(t),A=Math.floor(l.perSec*c*f);A>0&&(k(t,A),t.stats.totalOffline+=A,t.offline={lastGain:A,lastSeconds:c,lastAt:e},h(t,`Offline recovery: +${d(A)} signal in ${g(c*1e3)}.`)),t.lastActiveAt=e,x()}function He(t,e){yt.forEach(n=>{t.achievements[n.id]||n.test(t,e)&&(t.achievements[n.id]=!0,_t(t,n.reward),h(t,`Achievement unlocked: ${n.name}.`),p())})}function je(t,e){if(t.anomaly.endsAt&&e>=t.anomaly.endsAt&&(h(t,`Anomaly ended: ${t.anomaly.label}.`),t.anomaly={label:"",mult:1,endsAt:0},t.nextAnomalyAt=e+E(6e4,12e4)),!t.anomaly.endsAt&&e>=t.nextAnomalyAt){let n=Math.random()<.5,i=E(45e3,9e4),o=m(t.legacy,"dampers"),c=Math.max(3e4,Math.floor(i*(1-o*.08)));t.anomaly={label:n?"Anomaly Surge":"Signal Drag",mult:n?1.25:.8,endsAt:e+c},t.nextAnomalyAt=e+c+E(6e4,12e4),t.stats.anomalies+=1,h(t,`${t.anomaly.label} active for ${g(c)}.`)}}function Ve(t,e){t.aiEvent&&e>=t.aiEvent.expiresAt&&(h(t,"Director directive expired."),t.aiEvent=null,t.aiCooldownAt=e+E(9e4,15e4)),!t.aiEvent&&e>=t.aiCooldownAt&&(t.aiEvent=Ke(),h(t,`Director directive: ${t.aiEvent.title}.`))}function qe(t,e){t.buff&&e>=t.buff.endsAt&&(h(t,`${t.buff.label} expired.`),t.buff=null),t.ads.boostEndsAt&&e>=t.ads.boostEndsAt&&(t.ads.boostEndsAt=0)}function Ke(){let t=at(vt);return{id:t.id,title:t.title,body:t.body,options:t.options.map(e=>({id:e.id,label:e.label,summary:e.summary})),createdAt:Date.now(),expiresAt:Date.now()+12e4}}function Ye(t){let e=v();if(!e||!e.aiEvent)return;let n=vt.find(o=>o.id===e.aiEvent.id);if(!n)return;let i=n.options.find(o=>o.id===t);i&&(i.apply(e),h(e,`${e.aiEvent.title}: ${i.label}.`),e.aiEvent=null,e.aiCooldownAt=Date.now()+E(9e4,15e4),p())}function Rt(t){return sn(mt.slice()).slice(0,3).map(n=>{let i=n.goal(t),o=Math.floor(i*n.rewardScale);return{id:`${n.id}_${t}_${Math.floor(Math.random()*1e4)}`,templateId:n.id,goal:i,reward:o,rewardType:n.rewardType,claimed:!1}})}function It(t){return mt.find(e=>e.id===t)}function M(t,e){let n=I.reduce((rt,lt)=>{let Zt=m(t.upgrades,lt.id);return rt.perSec+=Zt*lt.perSec,rt.click+=Zt*lt.click,rt},{perSec:0,click:0}),i=m(t.research,"compression"),o=m(t.research,"distill"),c=m(t.research,"feedback"),l=m(t.research,"logistics"),f=m(t.research,"catalyst"),A=m(t.research,"analytics"),b=m(t.legacy,"echo"),$=m(t.legacy,"insight"),L=m(t.legacy,"shadow"),cn=m(t.meta,"atlas"),ct=Z(t),O=ze(t),rn=Je(t,e),Jt=Qe(t,e),Qt=e<t.ads.boostEndsAt?1.4:1,U=B(t),Xt=(1+i*.08)*(1+b*.05)*(1+cn*.07)*(1+ct.signal)*(1+U.signal)*O.signal*rn*Jt.signal*Qt,ln=(1+ct.click)*O.click*Jt.click,dn=(1+o*.1)*(1+$*.06)*(1+ct.insight)*(1+U.insight)*O.insight,un=(1+A*.1)*(1+L*.02)*(1+U.mission)*O.mission,fn=1+c*.04,pn=Math.max(.5,1-l*.08),hn=Wt(.08+f*.06+U.relic,0,.6);return{perSec:n.perSec*Xt,clickPower:(1+n.click)*ln,insightMult:dn,missionMult:un,resonanceMult:fn,expeditionSpeed:pn,relicChance:hn,signalMult:Xt,adMult:Qt}}function We(t){let e=on();if(t.daily.date===e)return;let n=at(ne);t.daily={date:e,id:n.id,label:n.label,signal:n.signal,click:n.click,insight:n.insight,mission:n.mission},h(t,`Daily directive: ${n.label}.`),p()}function ze(t){return t.daily?{signal:t.daily.signal||1,click:t.daily.click||1,insight:t.daily.insight||1,mission:t.daily.mission||1}:{signal:1,click:1,insight:1,mission:1}}function Je(t,e){return t.anomaly&&t.anomaly.endsAt&&e<t.anomaly.endsAt&&t.anomaly.mult||1}function Q(t,e,n,i,o){t.buff={label:e,mult:i,click:o,endsAt:Date.now()+n}}function Qe(t,e){return t.buff&&e<t.buff.endsAt?{signal:t.buff.mult||1,click:t.buff.click||1}:{signal:1,click:1}}function X(t,e){if(Math.random()>e.relicChance)return;let n=Xe();t.archive.push(n),h(t,`Relic recovered: ${n.name}.`),w(["archive","log","story"])}function Xe(){let t=at(ee);return{id:`relic_${Date.now()}_${Math.floor(Math.random()*1e3)}`,name:t.name,type:t.type,bonus:t.bonus,acquiredAt:Date.now()}}function Z(t){return t.archive.reduce((e,n)=>(e[n.type]!==void 0&&(e[n.type]+=n.bonus),e),{signal:0,click:0,insight:0})}function _t(t,e){e&&(e.type==="signal"&&k(t,e.amount),e.type==="insight"&&R(t,e.amount),e.type==="resonance"&&(t.resonance+=e.amount),e.type==="starlight"&&(t.starlight+=e.amount))}function k(t,e){!e||e<=0||(t.signal+=e,t.stats.totalEarned+=e,t.cycle.earned+=e)}function R(t,e){!e||e<=0||(t.insight+=e,t.stats.totalInsight+=e,t.cycle.insight+=e)}function tt(t,e){return e<=0||t.signal<e?!1:(t.signal-=e,t.stats.totalSpent+=e,t.cycle.spent+=e,!0)}function et(t){let e=m(t.legacy,"sponsor"),n=Math.max(.5,1-e*.05);return Math.floor(9e5*n)}function Nt(t){let e=m(t.meta,"stasis"),n=B(t);return Math.floor(14400*(1+e*.25+n.offline))}function Bt(t){return .65*(1+B(t).offline*.5)}function Ft(t){let n=Math.pow(1.28,t.stats.ascensions);return Math.floor(6e4*n)}function Ot(t){let n=Math.pow(1.5,t.stats.transcends);return Math.floor(120*n)}function Ut(t,e){let n=Ft(t);if(t.signal<n)return 0;let i=t.signal/n,o=Math.floor(Math.pow(i,.85)*10*e.resonanceMult);return Math.max(1,o)}function Pt(t){let e=Ot(t);if(t.resonance<e)return 0;let n=t.resonance/e,i=Math.floor(Math.pow(n,.9)*3);return Math.max(1,i)}function nt(t,e){return Math.floor(t.baseCost*Math.pow(t.growth,e))}function Gt(t,e){return Math.floor(t.baseCost*Math.pow(t.growth,e))}function Ht(t,e){return Math.floor(t.baseCost*Math.pow(t.growth,e))}function jt(t,e){return Math.floor(t.baseCost*Math.pow(t.growth,e))}function m(t,e){return t[e]||0}function it(t){return gt.find(e=>e.id===t)}function N(t){let e=C[0];for(let n=0;n<C.length;n+=1){let i=C[n];t>=i.threshold&&(e=i)}return e}function Ze(t){for(let e=0;e<C.length;e+=1){let n=C[e];if(t<n.threshold)return n}return null}function Vt(t){var n;if(!((n=t==null?void 0:t.faction)!=null&&n.id))return 0;let e=(t.faction.selectedAt||0)+432e5;return Math.max(0,e-Date.now())}function B(t){let e=it(t.faction.id);if(!e)return{signal:0,mission:0,insight:0,relic:0,expedition:0,offline:0};let i=N(t.faction.rep).mult;return{signal:(e.bonus.signal||0)*i,mission:(e.bonus.mission||0)*i,insight:(e.bonus.insight||0)*i,relic:(e.bonus.relic||0)*i,expedition:(e.bonus.expedition||0)*i,offline:(e.bonus.offline||0)*i}}function tn(t,e){let n=[];return t.bonus.signal&&n.push(`Signal +${Math.round(t.bonus.signal*e*100)}%`),t.bonus.mission&&n.push(`Mission +${Math.round(t.bonus.mission*e*100)}%`),t.bonus.insight&&n.push(`Insight +${Math.round(t.bonus.insight*e*100)}%`),t.bonus.relic&&n.push(`Relic +${Math.round(t.bonus.relic*e*100)}%`),t.bonus.expedition&&n.push(`Expedition +${Math.round(t.bonus.expedition*e*100)}%`),t.bonus.offline&&n.push(`Offline +${Math.round(t.bonus.offline*e*100)}%`),n.length?`| ${n.join(", ")}`:""}function st(t,e){if(!t.faction.id)return;let n=N(t.faction.rep),i=m(t.meta,"covenant"),o=Math.max(1,Math.floor(e*(1+i*.1)));t.faction.rep+=o;let c=N(t.faction.rep);c.name!==n.name&&h(t,`Faction rank up: ${c.name}.`),x()}function v(){return a.active?a.active.game:null}function F(){let t=v();if(!t||!s.signalMap||a.lastMapSeed===t.mapSeed)return;let e=()=>{let n=s.signalMap,i=n.getContext("2d"),o=n.width,c=n.height,l=an(t.mapSeed);i.clearRect(0,0,o,c),i.fillStyle="rgba(5, 10, 16, 0.8)",i.fillRect(0,0,o,c);let f=[],A=42;for(let b=0;b<A;b+=1)f.push({x:l()*o,y:l()*c,r:1+l()*2.5});i.strokeStyle="rgba(34, 211, 238, 0.25)",i.lineWidth=1;for(let b=0;b<f.length-1;b+=3){let $=f[b],L=f[b+1];!$||!L||(i.beginPath(),i.moveTo($.x,$.y),i.lineTo(L.x,L.y),i.stroke())}i.fillStyle="rgba(255, 255, 255, 0.85)",f.forEach(b=>{i.beginPath(),i.arc(b.x,b.y,b.r,0,Math.PI*2),i.fill()}),a.lastMapSeed=t.mapSeed};typeof window.requestIdleCallback=="function"?requestIdleCallback(e,{timeout:120}):setTimeout(e,0)}function en(){!s.adModal||!s.adCountdown||(s.adModal.classList.remove("hidden"),a.adEndsAt=Date.now()+8e3,u(s.adCountdown,`Relay sync ${g(8e3)}`),Kt(),a.adTimer&&clearInterval(a.adTimer),a.adTimeout&&clearTimeout(a.adTimeout),a.adTimer=setInterval(Kt,200),a.adTimeout=setTimeout(()=>Yt(),8250))}function qt(){a.adTimer&&(clearInterval(a.adTimer),a.adTimer=null),a.adTimeout&&(clearTimeout(a.adTimeout),a.adTimeout=null),s.adModal&&s.adModal.classList.add("hidden")}function Kt(){let t=a.adEndsAt-Date.now();if(t<=0){Yt();return}u(s.adCountdown,`Relay sync ${g(t)}`)}function Yt(){qt(),nn()}function nn(){let t=v();if(!t)return;let e=Date.now(),n=et(t);t.ads.boostEndsAt=e+6e5,t.ads.cooldownUntil=e+n,h(t,"Sponsor boost active."),x(),p()}function h(t,e){t.log.push({time:Date.now(),text:e}),t.log.length>50&&t.log.shift(),w(["log"])}function y(t){s.toast&&(s.toast.textContent=t,s.toast.classList.add("show"),G&&clearTimeout(G),G=setTimeout(()=>{s.toast.classList.remove("show")},2e3))}function d(t){if(!Number.isFinite(t))return"0";let e=t<0?"-":"",n=Math.abs(t);if(n<1e3){let l=n<10?2:n<100?1:0;return e+n.toFixed(l)}let i=["K","M","B","T"],o=-1;for(;n>=1e3&&o<i.length-1;)n/=1e3,o+=1;let c=n<10?2:n<100?1:0;return e+n.toFixed(c)+i[o]}function g(t){let e=Math.max(0,Math.ceil(t/1e3)),n=Math.floor(e/60),i=e%60;return n<=0?`${i}s`:`${n}:${String(i).padStart(2,"0")}`}function E(t,e){return Math.floor(Math.random()*(e-t+1))+t}function at(t){return t[Math.floor(Math.random()*t.length)]}function Wt(t,e,n){return Math.min(n,Math.max(e,t))}function sn(t){for(let e=t.length-1;e>0;e-=1){let n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function zt(){return Math.floor(Math.random()*1e9)}function an(t){let e=t>>>0;return()=>(e=e*1664525+1013904223>>>0,e/4294967296)}function on(){let t=new Date,e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${i}`}function u(t,e){if(!t)return;let n=String(e);t.textContent!==n&&(t.textContent=n)}function S(t,e){t&&t.innerHTML!==e&&(t.innerHTML=e)}function ot(t){let e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return String(t).replace(/[&<>"']/g,n=>e[n])}})();})();
